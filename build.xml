<?xml version="1.0"?>
<project name="WebPrac" default="run">
    <target name="path">
        <property name="srcDir" value="Source/java" />
        <property name="dstDir" value="Bin" />
        <property name="docDir" value="Documentation" />
        <property name="testDir" value="Source/test" />
        <property name="testDstDir" value="TestsRes" />
        <mkdir dir="${dstDir}"/>
        <mkdir dir="${testDstDir}"/>
    </target>

    <target name="clean" depends="path">
        <echo> Delete non-source files </echo>
        <delete dir="${dstDir}"/>
    </target>
    

    <target name="build" depends="path">
        <echo> Compile java files </echo>
        <javac srcdir="${srcDir}:${testDir}" 
            destdir="${dstDir}"
            includeantruntime="false">     
            <classpath>
                <pathelement path="lib/javax.persistence-api-2.2.jar"/>
            </classpath>
            <classpath>
                <pathelement path="lib/hibernate-core-6.0.0.Alpha6.jar"/>
            </classpath>
            <classpath>
                <pathelement path="lib/testng-7.4.0.jar"/>
            </classpath>
        </javac>
    </target>

    <target name="run" depends="build">
        <echo> Running application </echo>
        <java classname="Main" classpath="${dstDir}"/>
    </target>

    <target name="create-javadoc" depends="path">
        <mkdir dir="${docDir}" />
        <javadoc destdir="${docDir}"
            use="true"
            private="true"
            author="Svetlana Derevyanko"
            doctitle="WebPrac Documentation">
        <fileset dir="${srcDir}">
        </fileset>
        </javadoc>

    </target>
    
    <taskdef name="testng" classname="org.testng.TestNGAntTask" classpath="lib/testng-7.4.0.jar"/>
    
    <target name="test" depends="build">
        <fileset id="tests" dir="Bin/test">
            <include name="*"/>
        </fileset>

        <echo> Running tests </echo>
        <testng mode="mixed" classfilesetref="tests">
            <classpath location="Bin"/>
            <classpath>
                <fileset dir="lib" includes="*.jar"/>
                <fileset dir="Bin/" includes="*"/>
            </classpath>
            <xmlfileset dir="." includes="testng.xml"/>
        </testng>
    </target>

</project>
